<h2>Event Table</h2>
<a (click)="eventClicked('1')" class="nav-link">Link to an event with the id 1</a>
<div *ngIf="state && state.totalResults > 0; else noResults">
  <form (ngSubmit)="onSubmitSearch()" novalidate>
    <div class="form-group form-inline">
      <input class="form-control m-2" placeholder="Search..." type="text" [formControl]="state.searchTerm"/>
      <button class="btn btn-primary" type="submit">GO</button>
    </div>
  </form>

  <table class="table table-striped">
    <thead>
    <tr>
      <th scope="col" sortable="dev_name" (sort)="onSort($event)">Name</th>
      <th scope="col" sortable="place_ident" (sort)="onSort($event)">Place ID</th>
      <th scope="col" sortable="created" (sort)="onSort($event)">Created</th>
      <th scope="col" sortable="udpated" (sort)="onSort($event)">Last updated</th>
      <th scope="col">Tags</th>
      <th scope="col">State</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let event of state?.events">
      <!-- TODO: In case of empty value, add placeholder text  -->
      <td>{{ event?.metadata?.dev_name }}</td>
      <td>{{ event?.metadata?.place_ident }}</td>
      <td>{{ convertDate(event?.metadata?.created) }}</td>
      <td>{{ convertDate(event?.metadata?.updated) }}</td>
      <td>{{ convertTagNames(event?.tags) }}
        <span *ngIf="event?.tags.length > 2" class="text-muted"> & {{event?.tags?.length - 2}} more</span>
      </td>
      <td>
        <span [className]="'text-' + statesColorMapping[event?.metadata?.state]">
          {{event?.metadata?.state}}
        </span>
    </td>
    </tr>
    </tbody>
  </table>

  <div class="d-flex justify-content-between p-2">
    <ngb-pagination [collectionSize]="state.totalResults" [(page)]="state.page" [pageSize]="state.pageSize" (pageChange)="onPageChange()" [size]="'sm'">
    </ngb-pagination>

    <!-- TODO: Might be helpful to bind the ngModel to a different property that doesn't interfere with the pagination widget  -->
    <select class="custom-select" [(ngModel)]="state.pageSize" (ngModelChange)="onPageChange()">
      <option [ngValue]="10">10 items per page</option>
      <option [ngValue]="15">15 items per page</option>
      <option [ngValue]="20">20 items per page</option>
    </select>
  </div>
</div>

<ng-template #noResults>
  <p>No events found</p>
</ng-template>
